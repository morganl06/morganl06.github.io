---
title: "Racial disparities in traffic and pedestrian stops in three similar California cities"
format:
  html:
    code-fold: true   
---

Traffic stops are a critical point of interaction between law enforcement and the public, and they provide insight into potential disparities in policing. This project examines traffic stop data from three California cities—San Francisco, Oakland, and San Jose—drawn from the Stanford Open Policing Project. The goal of this analysis is to explore the relationship between city-level enforcement practices and racial disparities in traffic stops. I aim to identify patterns that reveal how race may influence stop frequency and stop type (vehicular vs pedestrian).

I selected these cities because they are all major urban areas within the same region of California, which allows for meaningful comparisons of traffic stop patterns because they share broad structural similarities (state-level policies, large population size, etc.).

```{r,warning = FALSE, message = FALSE}

library(DBI)
library(dplyr)
library(ggplot2)

con_traffic <- DBI::dbConnect(

  RMariaDB::MariaDB(),

  dbname = "traffic",

  host = Sys.getenv("TRAFFIC_HOST"),

  user = Sys.getenv("TRAFFIC_USER"),

  password = Sys.getenv("TRAFFIC_PWD")

)

```

```{sql connection=con_traffic, output.var = "ca_combined_summary"}
SELECT 
    city,
    subject_race AS race,
    COUNT(*) AS n_stops,
    SUM(CASE WHEN type = 'vehicular' THEN 1 ELSE 0 END) AS vehicular_stops,
    SUM(CASE WHEN type = 'pedestrian' THEN 1 ELSE 0 END) AS pedestrian_stops
FROM (
    SELECT subject_race, date, type, 'San Francisco' AS city 
      FROM ca_san_francisco_2020_04_01
    UNION ALL
    SELECT subject_race, date, type, 'Oakland' AS city 
      FROM ca_oakland_2020_04_01
    UNION ALL
    SELECT subject_race, date, type, 'San Jose' AS city 
      FROM ca_san_jose_2020_04_01
) AS combined
WHERE subject_race IS NOT NULL
GROUP BY city, race
ORDER BY city, race;
```

```{r, warning = FALSE, message = FALSE}

library(ggplot2)

ggplot(ca_combined_summary, aes(x = race, y = n_stops, fill = city)) +
  geom_col(position = "dodge") +
  labs(
    title = "Traffic Stops by Race in San Francisco, Oakland, and San Jose",
    x = "Race",
    y = "Number of Stops",
    fill = "City"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

This graph compares the total number of traffic stops for each racial group in San Francisco, Oakland, and San Jose. The pattern differs substantially across cities: San Francisco shows the highest number of stops for white individuals, Oakland shows the highest stop count for Black individuals, and San Jose has the highest stop count for Hispanic individuals.

These differences highlight that racial distributions in stop counts are not uniform across the three cities. However, interpreting these patterns requires caution, because each city has a different population size and racial composition. The raw stop counts cannot be interpreted as “stop rates,” and they do not directly indicate disparities on their own. Instead, the variation suggests that each city’s combination of demographics, policing strategies, and enforcement contexts may shape the overall distribution of stops. Additional population-adjusted calculations would be necessary to determine whether these differences reflect disproportionate impact or simply reflect the underlying demographics of each city.

```{sql connection=con_traffic, output.var="ca_plot2"}

SELECT 
    city,
    race,
    SUM(n_stops) AS total_stops,
    SUM(pedestrian_stops) AS total_pedestrian,
    100.0 * SUM(pedestrian_stops) / SUM(n_stops) AS pedestrian_pct
FROM (
    SELECT 
        city,
        subject_race AS race,
        COUNT(*) AS n_stops,
        SUM(CASE WHEN type = 'pedestrian' THEN 1 ELSE 0 END) AS pedestrian_stops
    FROM (
        SELECT subject_race, type, 'San Francisco' AS city
        FROM ca_san_francisco_2020_04_01
        UNION ALL
        SELECT subject_race, type, 'Oakland' AS city
        FROM ca_oakland_2020_04_01
        UNION ALL
        SELECT subject_race, type, 'San Jose' AS city
        FROM ca_san_jose_2020_04_01
    ) AS combined
    WHERE subject_race IS NOT NULL
    GROUP BY city, subject_race
) AS grouped
GROUP BY city, race
ORDER BY city, race;
```

```{r, warning = FALSE, message = FALSE}

library(ggplot2)
library(dplyr)

ggplot(ca_plot2, aes(x = race, y = pedestrian_pct, fill = city)) +
geom_col(position = "dodge") +
labs(
title = "Percent of Stops that Are Pedestrian Stops",
x = "Race",
y = "Pedestrian Stop Percentage"
) +
theme_minimal()
```

This graph shows the percentage of all stops that were pedestrian stops for each racial group across the three cities. The distribution varies by city. In San Jose, Black individuals have a noticeably higher share of pedestrian stops compared with Asian/Pacific Islander individuals, suggesting racial differences in how pedestrian versus vehicular stops occur. In Oakland, the percentages across racial groups are more similar, indicating that pedestrian stops there are not concentrated among any single group. San Francisco shows no pedestrian-stop data in this dataset, which limits cross-city comparisons and highlights differences in reporting or enforcement practices.

These observations point to meaningful variation in how cities conduct pedestrian stops, but they do not directly show whether the differences result from demographics, law enforcement strategy, neighborhood patterns, or other factors. To determine whether the differences reflect inequitable policing, additional contextual information—such as pedestrian population estimates or neighborhood-level exposure—would be necessary.

The datasets I used for this analysis were drawn from the following source:

Pierson, E., Simoiu, C., Overgoor, J., Corbett-Davies, S., Ramachandran, V., Phillips, C., & Goel, S. (2020). A large-scale analysis of racial disparities in police stops across the United States. Nature Human Behaviour, 4(7), 736–745. Stanford Open Policing Project (2020). Traffic stops database. <https://openpolicing.stanford.edu/>
